<?xml version="1.0" encoding="UTF-8"?>
<uranium:UraniumContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
            xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
            xmlns:ff="clr-namespace:FFImageLoading.Maui;assembly=FFImageLoading.Maui" 
            xmlns:views="clr-namespace:bsm24.Views"
            xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
            xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
            xmlns:m="clr-namespace:UraniumUI.Icons.MaterialSymbols;assembly=UraniumUI.Icons.MaterialSymbols"  
            Shell.TitleColor="{DynamicResource PrimaryDark}"
            BackgroundColor="{AppThemeBinding Light={DynamicResource PrimaryBackground}, Dark={DynamicResource PrimaryBackgroundDark}}"
            xmlns:local="clr-namespace:bsm24"
            xmlns:models="clr-namespace:bsm24.Models"
            xmlns:services="clr-namespace:bsm24.Services"                          
            x:Name="PinListPage"
            x:Class="bsm24.Views.PinList"
            Title="Pin Liste">
    
    <uranium:UraniumContentPage.Resources>
        <ResourceDictionary>
            <services:BooleanInverterConverter x:Key="BooleanInverterConverter" />
        </ResourceDictionary>
    </uranium:UraniumContentPage.Resources>

    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Border Grid.Row="0"
                HeightRequest="30"
                HorizontalOptions="End"
                StrokeThickness="0.5">
            <Grid>
                <Image Source="{FontImageSource FontFamily=MaterialOutlined, Color={AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}, Glyph={x:Static m:MaterialOutlined.Sort}}"                   
                       HorizontalOptions="Start"
                       Margin="10,0,0,0"
                       WidthRequest="20"
                       HeightRequest="20"
                       BackgroundColor="Transparent"/>
                <Picker x:Name="SortPicker" x:DataType="services:SettingsService" BindingContext="{x:Static services:SettingsService.Instance}"
                        WidthRequest="250"
                        HorizontalOptions="End"
                        VerticalOptions="Center"
                        HorizontalTextAlignment="End"
                        ItemsSource="{Binding PinSortCrits}"
                        SelectedItem="{Binding PinSortCrit}"
                        SelectedIndexChanged="OnSortPickerChanged">
                </Picker>
            </Grid>
        </Border>

        <Grid Grid.Row="1">
            <CollectionView x:Name="pinListView" SelectionMode="Single">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" VerticalItemSpacing="10"/>
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="local:PinItem">
                        <Grid RowSpacing="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="64" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <HorizontalStackLayout Grid.Column="0" Grid.Row="0" Grid.ColumnSpan="2" Spacing="0">
                                <Label Margin="10,4,0,0"
                                       FontAttributes="Bold"
                                       FontSize="12"
                                       Text="{Binding OnPlanName}"/>
                                <Label Margin="8,4,8,0"
                                       FontSize="12"
                                       Text="/"/>
                                <Label Margin="0,4,0,0"
                                       FontSize="12"
                                       Text="{Binding PinLocation}"/>
                            </HorizontalStackLayout>

                            <Label Grid.Column="0" Grid.Row="1" Grid.ColumnSpan="2"
                                   Margin="10,4,6,0"
                                   FontSize="12"
                                   LineBreakMode="TailTruncation"
                                   Text="{Binding PinName}"/>

                            <BoxView Grid.Column="0" Grid.Row="2" Grid.ColumnSpan="4"
                                     Color="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                                     HeightRequest="1"
                                     Margin="10,2,10,2"/>

                            <ff:CachedImage Grid.Column="0" Grid.Row="3"
                                    VerticalOptions="Start"
                                    Source="{Binding PinIcon}"
                                    CacheType="Memory"
                                    Aspect="AspectFit"
                                    Margin="16,20,6,0"/>

                            <Label Grid.Column="1" Grid.Row="3" Grid.ColumnSpan="2"
                                   MaxLines="4"
                                   LineBreakMode="WordWrap"
                                   MinimumHeightRequest="80"
                                   FontSize="12"
                                   Margin="0,4,6,4"
                                   Text="{Binding PinDesc}"/>

                            <Border Grid.ColumnSpan="4" Grid.RowSpan="4"
                                    IsVisible="{Binding AllowExport, Converter={StaticResource BooleanInverterConverter}}"
                                    Opacity="0.6"
                                    BackgroundColor="LightGray"/>

                            <Button Grid.ColumnSpan="4" Grid.RowSpan="4"
                                    ClassId="{Binding SelfId}"
                                    AutomationId = "{Binding OnPlanId}"                                    
                                    BorderWidth="1"
                                    BorderColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                                    Background="Transparent"
                                    Clicked="OnEditClicked"/>

                            <Button Grid.Column="2" Grid.Row="0" Grid.RowSpan="2"
                                    ClassId="{Binding SelfId}"
                                    AutomationId = "{Binding OnPlanId}"  
                                    Background="Transparent"
                                    ImageSource="{FontImageSource FontFamily=MaterialOutlined, Color={AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}, Glyph={x:Static m:MaterialOutlined.Recenter}}"
                                    Clicked="OnPinClicked"/>

                            <CheckBox Grid.Column="3" Grid.Row="0" Grid.RowSpan="2"
                                      IsChecked="{Binding AllowExport, Mode=TwoWay}"
                                      Color="{AppThemeBinding Light={DynamicResource PrimaryText}, Dark={DynamicResource PrimaryDark}}"/>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
    </Grid>
</uranium:UraniumContentPage>
