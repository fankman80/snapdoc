<?xml version="1.0" encoding="utf-8" ?>
<Mopups:PopupPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:Mopups="clr-namespace:Mopups.Pages;assembly=Mopups"
             xmlns:Animations="clr-namespace:Mopups.Animations;assembly=Mopups"
             xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
             xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
             xmlns:m="clr-namespace:UraniumUI.Icons.MaterialSymbols;assembly=UraniumUI.Icons.MaterialSymbols"
             xmlns:models="clr-namespace:bsm24.Models"
             xmlns:services="clr-namespace:bsm24.Services"
             x:Class="bsm24.Views.PopupExportSettings"
             BackgroundClicked="PopupPage_BackgroundClicked"
             BackgroundInputTransparent="False"
             CloseWhenBackgroundIsClicked="True"
             HasSystemPadding="False"
             BackgroundColor="#60000000"
             Title="Export Settings">

    <Grid>
        <Border
            StrokeShape="RoundRectangle 20,20,20,20"
            Margin="0,60,0,60"
            Padding="16,16,16,16"
            BackgroundColor="{AppThemeBinding Light={DynamicResource PrimaryBackground}, Dark={DynamicResource PrimaryBackgroundDark}}"
            WidthRequest="300"
            HorizontalOptions="Center"
            VerticalOptions="Center">

            <Grid VerticalOptions="FillAndExpand" HorizontalOptions="FillAndExpand">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <ScrollView Grid.Row="0" VerticalScrollBarVisibility="Always">
                    <VerticalStackLayout x:DataType="services:SettingsService">
                        <Button
                            Text="Template wählen"
                            BackgroundColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                            TextColor="{AppThemeBinding Light={DynamicResource PrimaryDarkText}, Dark={DynamicResource PrimaryText}}"
                            Clicked="OnTemplateManagerClicked" />
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="4*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <Label Text="Exportiere Pläne:" Grid.Column="0" Grid.Row="0" VerticalOptions="StartAndExpand"/>
                            <Label Text="Exportiere Positionsbilder:"  Grid.Column="0" Grid.Row="1" VerticalOptions="StartAndExpand"/>
                            <Label Text="Exportiere Pin-Icons:" Grid.Column="0" Grid.Row="3" VerticalOptions="StartAndExpand"/>
                            <Label Text="Exportiere Fotos:" Grid.Column="0" Grid.Row="2" VerticalOptions="StartAndExpand"/>                           
                            <Label Text="Exportiere Foto-Overlays:" Grid.Column="0" Grid.Row="4" VerticalOptions="StartAndExpand"/>

                            <Switch Grid.Column="1" Grid.Row="0"
                                    Margin="0,-8,0,0"                       
                                    ThumbColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDarkAccent}}"
                                    OnColor="{DynamicResource Secondary}"
                                    IsToggled="{Binding IsPlanExport}"/>

                            <Switch Grid.Column="1" Grid.Row="1"
                                    Margin="0,-8,0,0"                      
                                    ThumbColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDarkAccent}}"
                                    OnColor="{DynamicResource Secondary}"
                                    IsToggled="{Binding IsPosImageExport}"/>

                            <Switch Grid.Column="1" Grid.Row="3"
                                    Margin="0,-8,0,0"
                                    VerticalOptions="Start"
                                    ThumbColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDarkAccent}}"
                                    OnColor="{DynamicResource Secondary}"
                                    IsToggled="{Binding IsPinIconExport}"/>
                            
                            <Switch Grid.Column="1" Grid.Row="2"
                                    Margin="0,-8,0,0"
                                    ThumbColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDarkAccent}}"
                                    OnColor="{DynamicResource Secondary}"
                                    IsToggled="{Binding IsImageExport}"/>                            

                            <Switch Grid.Column="1" Grid.Row="4"
                                    Margin="0,-8,0,0"
                                    VerticalOptions="Start"
                                    ThumbColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDarkAccent}}"
                                    OnColor="{DynamicResource Secondary}"
                                    IsToggled="{Binding IsFotoOverlayExport}"/>
                        </Grid>

                        <Label Text="Pin-Icons / Prefix und Schriftgrösse:" Margin="0, 0, 0, -12"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="4*" />
                                <ColumnDefinition Width="2*" />
                            </Grid.ColumnDefinitions>
 
                            <material:TextField Grid.Column="0"
                                Text="{Binding PlanLabelPrefix}"
                                TextColor="{AppThemeBinding Light={DynamicResource PrimaryText}, Dark={DynamicResource PrimaryDarkText}}"
                                BorderColor="{AppThemeBinding Light={DynamicResource SecondaryBackground}, Dark={DynamicResource SecondaryBackground}}"
                                AccentColor="{AppThemeBinding Light={DynamicResource PrimaryAccent}, Dark={DynamicResource SecondaryDark}}" />
                            <material:TextField Grid.Column="1"
                                                HorizontalTextAlignment="Center"
                                Text="{Binding PlanLabelFontSize}"
                                TextColor="{AppThemeBinding Light={DynamicResource PrimaryText}, Dark={DynamicResource PrimaryDarkText}}"
                                BorderColor="{AppThemeBinding Light={DynamicResource SecondaryBackground}, Dark={DynamicResource SecondaryBackground}}"
                                AccentColor="{AppThemeBinding Light={DynamicResource PrimaryAccent}, Dark={DynamicResource SecondaryDark}}" />
                        </Grid>

                        <Label Text="{Binding PinExportSize, StringFormat='Pin-Grösse: {0:0.##} mm'}" Margin="0, 0, 0, -12"/>
                        <Slider Maximum="20"
                                Minimum="1"
                                ThumbColor="{DynamicResource Primary}"
                                MinimumTrackColor="{DynamicResource Primary}"
                                MaximumTrackColor="{DynamicResource PrimaryDark}"
                                Value="{Binding PinExportSize}"/>

                        <Label Text="{Binding ImageExportSize, StringFormat='Foto Grösse: {0:0.##} mm'}" Margin="0, 0, 0, -12"/>
                        <Slider Maximum="160"
                                Minimum="10"
                                ThumbColor="{DynamicResource Primary}"
                                MinimumTrackColor="{DynamicResource Primary}"
                                MaximumTrackColor="{DynamicResource PrimaryDark}"
                                Value="{Binding ImageExportSize}"/>

                        <Label Text="{Binding ImageExportScale, StringFormat='Foto Auflösung: {0:0.##}'}" Margin="0, 0, 0, -12"/>
                        <Slider Maximum="1"
                                Minimum="0.01"
                                ThumbColor="{DynamicResource Primary}"
                                MinimumTrackColor="{DynamicResource Primary}"
                                MaximumTrackColor="{DynamicResource PrimaryDark}"
                                Value="{Binding ImageExportScale}"/>

                        <Label Text="{Binding PinPosExportSize, StringFormat='Positionsbilder Grösse: {0:0.##} mm'}" Margin="0, 0, 0, -12"/>
                        <Slider Maximum="160"
                                Minimum="10"
                                ThumbColor="{DynamicResource Primary}"
                                MinimumTrackColor="{DynamicResource Primary}"
                                MaximumTrackColor="{DynamicResource PrimaryDark}"
                                Value="{Binding PinPosExportSize}"/>

                        <Label Text="{Binding PosImageExportScale, StringFormat='Positionsbilder Auflösung: {0:0.##}'}" Margin="0, 0, 0, -12"/>
                        <Slider Maximum="1"
                                Minimum="0.01"
                                ThumbColor="{DynamicResource Primary}"
                                MinimumTrackColor="{DynamicResource Primary}"
                                MaximumTrackColor="{DynamicResource PrimaryDark}"
                                Value="{Binding PosImageExportScale}"/>

                        <Label Text="{Binding PinPosCropExportSize, StringFormat='Positionsbilder Zuschnitt: {0:0.##} Pixel'}" Margin="0, 0, 0, -12"/>
                        <Slider Maximum="1000"
                                Minimum="100"
                                ThumbColor="{DynamicResource Primary}"
                                MinimumTrackColor="{DynamicResource Primary}"
                                MaximumTrackColor="{DynamicResource PrimaryDark}"
                                Value="{Binding PinPosCropExportSize}"/>

                        <Label Text="{Binding ImageExportQuality, StringFormat='Bildqualität: {0:0.##}%'}" Margin="0, 0, 0, -12"/>
                        <Slider Maximum="100"
                                Minimum="10"
                                ThumbColor="{DynamicResource Primary}"
                                MinimumTrackColor="{DynamicResource Primary}"
                                MaximumTrackColor="{DynamicResource PrimaryDark}"
                                Value="{Binding ImageExportQuality}"/>

                        <Label Text="{Binding TitleExportSize, StringFormat='Titelbildhöhe: {0:0.##} mm'}" Margin="0, 0, 0, -12"/>
                        <Slider Maximum="300"
                                Minimum="10"
                                ThumbColor="{DynamicResource Primary}"
                                MinimumTrackColor="{DynamicResource Primary}"
                                MaximumTrackColor="{DynamicResource PrimaryDark}"
                                Value="{Binding TitleExportSize}"/>
                    </VerticalStackLayout>
                </ScrollView>

                <Grid  Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Button Grid.Column="0"
                        Padding="0"
                        BackgroundColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                        TextColor="{AppThemeBinding Light={DynamicResource PrimaryDarkText}, Dark={DynamicResource PrimaryText}}"
                        ImageSource="{FontImageSource FontFamily=MaterialOutlined, Color={AppThemeBinding Light={DynamicResource PrimaryDarkText}, Dark={DynamicResource PrimaryText}}, Glyph={x:Static m:MaterialOutlined.Close}}"
                        Clicked="OnCancelClicked" />
                    <Button Grid.Column="1"
                        Padding="0"
                        BackgroundColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                        TextColor="{AppThemeBinding Light={DynamicResource PrimaryDarkText}, Dark={DynamicResource PrimaryText}}"
                        ImageSource="{FontImageSource FontFamily=MaterialOutlined, Color={AppThemeBinding Light={DynamicResource PrimaryDarkText}, Dark={DynamicResource PrimaryText}}, Glyph={x:Static m:MaterialOutlined.Share}}"
                        Clicked="OnShareClicked" />
                    <Button Grid.Column="2"
                        Padding="0"
                        BackgroundColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                        TextColor="{AppThemeBinding Light={DynamicResource PrimaryDarkText}, Dark={DynamicResource PrimaryText}}"
                        ImageSource="{FontImageSource FontFamily=MaterialOutlined, Color={AppThemeBinding Light={DynamicResource PrimaryDarkText}, Dark={DynamicResource PrimaryText}}, Glyph={x:Static m:MaterialOutlined.Save}}"
                        Clicked="OnSaveClicked" />
                </Grid>
            </Grid>
        </Border>
        <Grid x:Name="busyOverlay"
              BackgroundColor="Black"
              Opacity="0.7"
              IsVisible="False"
              VerticalOptions="FillAndExpand"
              HorizontalOptions="FillAndExpand"
              ZIndex="10">
            <StackLayout VerticalOptions="Center" HorizontalOptions="Center">
                <ActivityIndicator x:Name="activityIndicator"
                                   IsRunning="True"
                                   VerticalOptions="Center"
                                   HorizontalOptions="Center"
                                   Color="White" />
                <Label x:Name="busyText"
                       Text="Bitte warten..."
                       TextColor="White"
                       FontSize="Medium"
                       HorizontalOptions="Center" />
            </StackLayout>
        </Grid>
    </Grid>
</Mopups:PopupPage>