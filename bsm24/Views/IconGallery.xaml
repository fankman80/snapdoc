<?xml version="1.0" encoding="UTF-8"?>
<uranium:UraniumContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:ff="clr-namespace:FFImageLoading.Maui;assembly=FFImageLoading.Maui" 
             xmlns:views="clr-namespace:bsm24.Views"
             xmlns:mr="clr-namespace:MR.Gestures;assembly=MR.Gestures"
             xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
             xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
             xmlns:m="clr-namespace:UraniumUI.Icons.MaterialSymbols;assembly=UraniumUI.Icons.MaterialSymbols"            
             xmlns:services="clr-namespace:bsm24.Services"
             xmlns:local="clr-namespace:bsm24"
             x:Name="IconGalleryPage"
             x:Class="bsm24.Views.IconGallery"
             BackgroundColor="White"
             Shell.TitleColor="{DynamicResource PrimaryDark}"
             Title="Pin auswählen">

    <ContentPage.ToolbarItems>
        <ToolbarItem x:Name ="ImportIcon"                     
                     IconImageSource="{FontImageSource FontFamily=MaterialOutlined, Color={DynamicResource PrimaryDark}, Glyph={x:Static m:MaterialOutlined.Add}}"             
                     Text="Icon importieren"
                     Clicked="ImportIconClicked"/>
    </ContentPage.ToolbarItems>

    <Grid RowSpacing="10" Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />            
        </Grid.RowDefinitions>

        <Border Grid.Row="0"
                HeightRequest="30"
                HorizontalOptions="End"
                StrokeThickness="0.5">
            <Grid>
                <Image Source="{FontImageSource FontFamily=MaterialOutlined, Color={AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}, Glyph={x:Static m:MaterialOutlined.Sort}}"                   
                       HorizontalOptions="Start"
                       Margin="10,0,0,0"
                       WidthRequest="20"
                       HeightRequest="20"
                       BackgroundColor="Transparent"/>
                <Picker x:Name="SortPicker" x:DataType="services:SettingsService" BindingContext="{x:Static services:SettingsService.Instance}"
                        WidthRequest="250"
                        HorizontalOptions="End"
                        VerticalOptions="Center"
                        HorizontalTextAlignment="End"
                        ItemsSource="{Binding IconSortCrits}"
                        SelectedItem="{Binding IconSortCrit}"
                        SelectedIndexChanged="OnSortPickerChanged">
                </Picker>
            </Grid>
        </Border>

        <Grid Grid.Row="1" x:DataType="views:IconGallery">
            <CollectionView x:Name="IconCollectionView"
                            ItemsSource="{Binding Icons}"
                            SelectionMode="Single">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" />
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid x:DataType="local:IconItem" HeightRequest="48">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <ff:CachedImage Grid.Column="0"
                                            Source="{Binding FileName}"
                                            CacheType="Memory"
                                            Aspect="AspectFill"
                                            Margin="6,6,6,6"/>
                            <Label Grid.Column="1"
                                   Text="{Binding DisplayName}"
                                   VerticalOptions="Center"
                                   Margin="16,0,0,0"
                                   LineBreakMode="WordWrap"/>
                            <mr:Button Grid.ColumnSpan="2"
                                    AutomationId = "{Binding FileName}"
                                    Background="Transparent"
                                    LongPressing="OnLongPressed"
                                    Clicked="OnIconClicked"
                                    Tapped="OnIconClicked">
                            </mr:Button>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
        <Label Grid.Row="2" Text="Gedrückt halten um Icon zu editieren." FontSize="12"/>        
    </Grid>
</uranium:UraniumContentPage>