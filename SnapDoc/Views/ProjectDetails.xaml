<?xml version="1.0" encoding="UTF-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/maui/global"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
             xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
             xmlns:views="clr-namespace:SnapDoc.Views"            
             xmlns:services="clr-namespace:SnapDoc.Services"
             xmlns:res="clr-namespace:SnapDoc.Resources.Languages"
             xmlns:local="clr-namespace:SnapDoc"
             Shell.TitleColor="{DynamicResource PrimaryDark}"
             Shell.BackgroundColor="{DynamicResource SecondaryBackgroundDark}"
             BackgroundColor="{AppThemeBinding Light={DynamicResource PrimaryBackground}, Dark={DynamicResource PrimaryBackgroundDark}}"
             x:Class="SnapDoc.Views.ProjectDetails"
             x:Name="ThisPage"             
             Title="{x:Static res:AppResources.projektverwaltung}">

    <Shell.TitleView>
        <Grid ColumnDefinitions="*, Auto,Auto"
              ColumnSpacing="0">
            <Label Grid.Row="0"
                   x:DataType="views:ProjectDetails"
                   Text="{Binding Title, Source={x:Reference Name=ThisPage}}"
                   TextColor="{DynamicResource PrimaryDark}"
                   Background="Transparent"
                   BackgroundColor="Transparent"
                   FontSize="18"
                   VerticalOptions="Center"
                   HorizontalOptions="Start"/>
            <Button Grid.Column="1"                    
                    Text="{x:Static local:MaterialIcons.Photo_camera}"
                    FontSize="24"
                    Padding="0"
                    TextColor="{DynamicResource PrimaryDark}"
                    Background="Transparent"
                    FontFamily="MaterialOutlined"
                    VerticalOptions="Center"
                    HorizontalOptions="End"
                    ToolTipProperties.Text="{x:Static res:AppResources.titelbild_mit_der_kamera_erstellen}"
                    Clicked="OnTitleCaptureClicked"/>
            <Button Grid.Column="2"                    
                    Text="{x:Static local:MaterialIcons.Image_search}"
                    FontSize="24"
                    Padding="0"
                    TextColor="{DynamicResource PrimaryDark}"
                    Background="Transparent"
                    FontFamily="MaterialOutlined"
                    VerticalOptions="Center"
                    HorizontalOptions="End"
                    ToolTipProperties.Text="{x:Static res:AppResources.titelbild_von_der_festplatte_hochladen}"
                    Clicked="OnTitleOpenClicked"/>
        </Grid>
    </Shell.TitleView>

    <ContentPage.Resources>
        <ResourceDictionary>
            <toolkit:MultiConverter x:Key="HeightConverter">
                <toolkit:IsStringNotNullOrEmptyConverter />
                <toolkit:MathExpressionConverter />
            </toolkit:MultiConverter>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid x:DataType="services:SettingsService" BindingContext="{x:Static services:SettingsService.Instance}" RowSpacing="0">
        <Grid.RowDefinitions>
            <RowDefinition Height="{Binding FlyoutHeaderImage, Converter={StaticResource HeightConverter}, ConverterParameter='x==true?100:0'}" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <ImageButton Grid.Row="0"
                     Source="{Binding FlyoutHeaderImage}"
                     Aspect="AspectFill"
                     HorizontalOptions="Fill"
                     VerticalOptions="Fill"
                     Clicked="OnImageTapped"/>

        <Grid Grid.Row="1" Margin="16,6,16,16">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <ScrollView Grid.Row="0" Margin="0,10,0,10">
                <VerticalStackLayout Spacing="8">
                    <material:TextField
                        x:Name="client_name"
                        MaxLength="200"
                        TitleColor="{DynamicResource SecondaryBackground}"
                        BorderColor="{DynamicResource SecondaryBackground}"
                        TextColor="{AppThemeBinding Light={DynamicResource PrimaryText}, Dark={DynamicResource PrimaryDarkText}}"
                        AccentColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                        AllowClear="True"
                        Title="{x:Static res:AppResources.kunde_bauherrschaft}"/>

                    <material:TextField
                        x:Name="object_name"
                        MaxLength="200"
                        TitleColor="{DynamicResource SecondaryBackground}"
                        BorderColor="{DynamicResource SecondaryBackground}"
                        TextColor="{AppThemeBinding Light={DynamicResource PrimaryText}, Dark={DynamicResource PrimaryDarkText}}"
                        AccentColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                        AllowClear="True"
                        Title="{x:Static res:AppResources.objektbezeichnung}"/>

                    <material:EditorField
                        x:Name="object_address"
                        MaxLength="500"
                        TitleColor="{DynamicResource SecondaryBackground}"
                        BorderColor="{DynamicResource SecondaryBackground}"
                        TextColor="{AppThemeBinding Light={DynamicResource PrimaryText}, Dark={DynamicResource PrimaryDarkText}}"
                        AccentColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                        Title="{x:Static res:AppResources.adresse}"/>

                    <material:TextField
                        x:Name="working_title"
                        MaxLength="200"
                        TitleColor="{DynamicResource SecondaryBackground}"
                        BorderColor="{DynamicResource SecondaryBackground}"
                        TextColor="{AppThemeBinding Light={DynamicResource PrimaryText}, Dark={DynamicResource PrimaryDarkText}}"
                        AccentColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                        AllowClear="True"
                        Title="{x:Static res:AppResources.projektvorgang}"/>

                    <material:TextField
                        x:Name="project_nr"
                        MaxLength="200"
                        TitleColor="{DynamicResource SecondaryBackground}"
                        BorderColor="{DynamicResource SecondaryBackground}"
                        TextColor="{AppThemeBinding Light={DynamicResource PrimaryText}, Dark={DynamicResource PrimaryDarkText}}"
                        AccentColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                        AllowClear="True"
                        Title="Projektnummer"/>

                    <material:TextField
                        x:Name="project_manager"
                        MaxLength="200"
                        TitleColor="{DynamicResource SecondaryBackground}"
                        BorderColor="{DynamicResource SecondaryBackground}"
                        TextColor="{AppThemeBinding Light={DynamicResource PrimaryText}, Dark={DynamicResource PrimaryDarkText}}"
                        AccentColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                        AllowClear="True"
                        Title="{x:Static res:AppResources.projektleitung}"/>

                    <material:DatePickerField
                        x:Name="creation_date"
                        TitleColor="{DynamicResource SecondaryBackground}"
                        BorderColor="{DynamicResource SecondaryBackground}"
                        TextColor="{AppThemeBinding Light={DynamicResource PrimaryText}, Dark={DynamicResource PrimaryDarkText}}"
                        AccentColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                        Icon="{FontImageSource FontFamily=MaterialOutlined, Color={AppThemeBinding Light={DynamicResource PrimaryText}, Dark={DynamicResource PrimaryDarkText}}, Glyph={x:Static local:MaterialIcons.Calendar_month}}"                        
                        AllowClear="False"
                        Title="{x:Static res:AppResources.datum}">
                    </material:DatePickerField>
                </VerticalStackLayout>
            </ScrollView>

            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Button Grid.Column="1"
                        Padding="0"
                        MinimumWidthRequest="100"
                        BackgroundColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                        TextColor="{DynamicResource PrimaryDarkText}"
                        ImageSource="{FontImageSource FontFamily=MaterialOutlined, Color={DynamicResource PrimaryDarkText}, Glyph={x:Static local:MaterialIcons.Picture_as_pdf}}"
                        ToolTipProperties.Text="{x:Static res:AppResources.pdf_seiten_hinzufügen}"
                        Clicked="OnAddPdfClicked"/>
                <Button Grid.Column="2"
                        Text="{x:Static res:AppResources.ok}"
                        MinimumWidthRequest="100"
                        BackgroundColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                        TextColor="{DynamicResource PrimaryDarkText}"
                        Clicked="OnOkayClicked"/>
            </Grid>
        </Grid>

        <!-- Overlay für Busy-Indikator -->
        <local:BusyOverlayView x:Name="busyOverlay"
                               AbsoluteLayout.LayoutBounds="0,0,1,1"
                               AbsoluteLayout.LayoutFlags="All"/>
    </Grid>
</ContentPage>
