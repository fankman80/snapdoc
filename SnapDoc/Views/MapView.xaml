<?xml version="1.0" encoding="UTF-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
                xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                xmlns:views="clr-namespace:SnapDoc.Views"
                xmlns:mr="clr-namespace:MR.Gestures;assembly=MR.Gestures"
                xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
                xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
                xmlns:m="clr-namespace:UraniumUI.Icons.MaterialSymbols;assembly=UraniumUI.Icons.MaterialSymbols"
                xmlns:services="clr-namespace:SnapDoc.Services"
                xmlns:local="clr-namespace:SnapDoc"
                Shell.TitleColor="{DynamicResource PrimaryDark}"
                x:Class="SnapDoc.Views.MapView"
                Title="swisstopo Karte">

    <ContentPage.ToolbarItems>
        <ToolbarItem IconImageSource="{FontImageSource FontFamily=MaterialOutlined, Color={DynamicResource PrimaryDark}, Glyph={x:Static m:MaterialOutlined.Moved_location}}"
                     Text="KML exportieren"
                     Clicked="KmlExportClicked"/>
    </ContentPage.ToolbarItems>

    <Grid>
        <AbsoluteLayout>
            <WebView x:Name="GeoAdminWebView"
                     AbsoluteLayout.LayoutBounds="0,0,1,1"
                     AbsoluteLayout.LayoutFlags="All" />

            <Border BackgroundColor="White"
                    Scale="0.8"
                    Margin="8"
                    Stroke="DarkGrey"
                    StrokeThickness="1"
                    StrokeShape="RoundRectangle 4"
                    AbsoluteLayout.LayoutBounds="0.5,0,AutoSize,AutoSize"
                    AbsoluteLayout.LayoutFlags="PositionProportional">
                <Picker x:Name="mapLayerPicker" FontSize="12"/>
            </Border>

            <StackLayout Orientation="Vertical"
                         Spacing="14"
                         Padding="14"
                         AbsoluteLayout.LayoutBounds="1,1,AutoSize,AutoSize"
                         AbsoluteLayout.LayoutFlags="PositionProportional">
                <Border Grid.Column="0"
                        WidthRequest="60"
                        HeightRequest="60"
                        Stroke="{AppThemeBinding Light={DynamicResource PrimaryDarkText}, Dark={DynamicResource PrimaryText}}"
                        StrokeThickness="1"
                        HorizontalOptions="End"
                        BackgroundColor="White"
                        StrokeShape="RoundRectangle 30">
                    <Image Source="mapcolorbtn.png"/>
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnMapLayerColorClicked"/>
                    </Border.GestureRecognizers>
                    <Border.Shadow>
                        <Shadow Brush="Black" Opacity="0.4" Offset="4,4" Radius="6"/>
                    </Border.Shadow>
                </Border>
                <Border
                    WidthRequest="60"
                    HeightRequest="60"
                    Stroke="{AppThemeBinding Light={DynamicResource PrimaryDarkText}, Dark={DynamicResource PrimaryText}}"
                    StrokeThickness="1"
                    HorizontalOptions="End"
                    BackgroundColor="White"
                    StrokeShape="RoundRectangle 30">
                    <Image Source="maprealbtn.png"/>
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnMapLayerRealClicked"/>
                    </Border.GestureRecognizers>
                    <Border.Shadow>
                        <Shadow Brush="Black" Opacity="0.4" Offset="4,4" Radius="6"/>
                    </Border.Shadow>
                </Border>
                <Button ImageSource="{FontImageSource FontFamily=MaterialOutlined, Color={AppThemeBinding Light={DynamicResource PrimaryDarkText}, Dark={DynamicResource PrimaryText}}, Glyph={x:Static m:MaterialOutlined.Save}}"
                        WidthRequest="60"
                        HeightRequest="60"
                        CornerRadius="30"
                        HorizontalOptions="End"
                        BackgroundColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                        TextColor="{AppThemeBinding Light={DynamicResource PrimaryDarkText}, Dark={DynamicResource PrimaryText}}"
                        Clicked="GetCoordinatesClicked">
                    <Button.Shadow>
                        <Shadow Brush="Black" Opacity="0.4" Offset="4,4" Radius="6"/>
                    </Button.Shadow>
                </Button>
                <Border x:Name="SetPosBtn"
                        IsVisible="False"
                        Padding="10,10,14,10"
                        HeightRequest="60"
                        StrokeThickness="0"
                        BackgroundColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                        StrokeShape="RoundRectangle 30">
                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="SetPosClicked"/>
                    </Border.GestureRecognizers>
                    <Border.Shadow>
                        <Shadow Brush="Black" Opacity="0.4" Offset="4,4" Radius="6" />
                    </Border.Shadow>
                    <Grid ColumnDefinitions="60,*"
                          ColumnSpacing="6"
                          VerticalOptions="Center"
                          HorizontalOptions="Center">
                        <Image x:Name="SetPosBtnIcon"
                               Grid.Column="0"
                               Source="{AppThemeBinding Light=ic_pin_dark.png, Dark=ic_pin_light.png}" />
                        <Label Grid.Column="1"
                               Text="Neu setzen"
                               HorizontalTextAlignment="Center"
                               VerticalTextAlignment="Center"
                               TextColor="{AppThemeBinding Light={DynamicResource PrimaryDarkText}, Dark={DynamicResource PrimaryText}}" />
                    </Grid>
                </Border>
            </StackLayout>
        </AbsoluteLayout>
    </Grid>
</ContentPage>
