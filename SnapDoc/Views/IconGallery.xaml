<?xml version="1.0" encoding="UTF-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/maui/global"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:mr="clr-namespace:MR.Gestures;assembly=MR.Gestures"
             xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
             xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
             xmlns:views="clr-namespace:SnapDoc.Views"             
             xmlns:services="clr-namespace:SnapDoc.Services"
             xmlns:res="clr-namespace:SnapDoc.Resources.Languages"
             xmlns:local="clr-namespace:SnapDoc"
             x:Name="ThisPage"
             x:Class="SnapDoc.Views.IconGallery"
             Shell.TitleColor="{DynamicResource PrimaryDark}"
             Shell.BackgroundColor="{DynamicResource SecondaryBackgroundDark}"
             BackgroundColor="{AppThemeBinding Light={DynamicResource PrimaryBackground}, Dark={DynamicResource PrimaryBackgroundDark}}"
             Title="{x:Static res:AppResources.icon_ausw채hlen}">

    <Shell.TitleView>
        <Grid ColumnDefinitions="*,Auto,Auto"
              ColumnSpacing="0"
              VerticalOptions="Center">
            <Label Grid.Column="0"
                   x:DataType="views:IconGallery"
                   Text="{Binding Title, Source={x:Reference Name=ThisPage}}"
                   TextColor="{DynamicResource PrimaryDark}"
                   Background="Transparent"
                   BackgroundColor="Transparent"
                   FontSize="18"
                   VerticalOptions="Center"
                   HorizontalOptions="Start"/>
            <Button Grid.Column="1"
                    x:Name="btnRows"
                    FontSize="24"
                    Padding="0"
                    TextColor="{DynamicResource PrimaryDark}"
                    Background="Transparent"
                    FontFamily="MaterialOutlined"
                    VerticalOptions="Center"
                    HorizontalOptions="End"
                    ToolTipProperties.Text="{x:Static res:AppResources.raster_liste_umschalten}"
                    Clicked="OnChangeRowsClicked"/>
            <Button Grid.Column="2"
                    Text="{x:Static local:MaterialIcons.Add}"
                    FontSize="24"
                    Padding="0"
                    TextColor="{DynamicResource PrimaryDark}"
                    Background="Transparent"
                    FontFamily="MaterialOutlined"
                    VerticalOptions="Center"
                    HorizontalOptions="End"
                    ToolTipProperties.Text="{x:Static res:AppResources.neues_icon_erstellen}"
                    Clicked="ImportIconClicked"/>
        </Grid>
    </Shell.TitleView>

    <ContentPage.Resources>
        <ResourceDictionary>
            <services:SkColorToHexConverter x:Key="SkColorToHexConverter"/>            
            
            <!-- Template f체r Liste (Label sichtbar) -->
            <DataTemplate x:Key="IconListTemplate" x:DataType="local:IconItem">
                <Grid HeightRequest="48">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="100" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="26" />
                    </Grid.ColumnDefinitions>
                    <Image Grid.Column="0"
                           Source="{Binding DisplayIconPath}"
                           Aspect="AspectFit"
                           Margin="5"/>
                    <Label Grid.Column="1"
                           Text="{Binding DisplayName}"
                           VerticalOptions="Center"
                           LineBreakMode="WordWrap"/>
                    <Button Grid.Column="2"
                             AutomationId = "{Binding FileName}"
                             IsVisible="{Binding IsDefaultIcon}"
                             Padding="0"
                             BackgroundColor="Transparent"
                             ImageSource="{FontImageSource FontFamily=MaterialOutlined, Color={AppThemeBinding Light={DynamicResource PrimaryText}, Dark={DynamicResource PrimaryDarkText}}, Glyph={x:Static local:MaterialIcons.Bookmark_star}}"/>
                    <BoxView Grid.Column="3"
                             Margin="0,0,10,0"
                             HeightRequest="26"
                             WidthRequest="26"
                             CornerRadius="6"
                             BackgroundColor="{Binding PinColor, Converter={StaticResource SkColorToHexConverter}}"/>
                    <mr:Button Grid.Column="0" Grid.ColumnSpan="2"
                               AutomationId = "{Binding FileName}"
                               BorderColor="Transparent"
                               Background="Transparent"
                               LongPressing="OnLongPressed"
                               Clicked="OnIconClicked"
                               Tapped="OnIconClicked"/>
                </Grid>
            </DataTemplate>

            <!-- Template f체r Grid (Label unsichtbar) -->
            <DataTemplate x:Key="IconGridTemplate" x:DataType="local:IconItem">
                <Grid>
                    <Image Source="{Binding DisplayIconPath}"
                           Aspect="AspectFit"
                           Margin="6"/>
                    <mr:Button AutomationId = "{Binding FileName}"
                               BorderColor="Transparent"
                               Background="Transparent"
                               LongPressing="OnLongPressed"
                               Clicked="OnIconClicked"
                               Tapped="OnIconClicked"/>
                </Grid>
            </DataTemplate>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowSpacing="10" Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Border Grid.Row="0" HorizontalOptions="Start"
                VerticalOptions="Center"
                HeightRequest="38"
                StrokeThickness="1"
                Stroke="{DynamicResource Primary}"
                StrokeShape="RoundRectangle 4">
            <Grid VerticalOptions="Center" HorizontalOptions="Fill">
                <Picker x:Name="CategoryPicker"
                        x:DataType="services:SettingsService"
                        BindingContext="{x:Static services:SettingsService.Instance}"
                        FontSize="10"
                        VerticalOptions="Center"
                        HorizontalOptions="Fill"
                        ItemsSource="{Binding IconCategories}"
                        SelectedItem="{Binding IconCategory}" />
            </Grid>
        </Border>

        <HorizontalStackLayout Grid.Row="0" HorizontalOptions="End" >
            <Button x:Name="SortDirection"
                    Text="{x:Static local:MaterialIcons.Sort}"
                    FontSize="36"
                    FontFamily="MaterialOutlined"
                    TextColor="{DynamicResource Primary}"
                    CornerRadius="4"
                    Padding="0"            
                    HeightRequest="38"
                    WidthRequest="38"
                    MinimumHeightRequest="38"
                    MinimumWidthRequest="38"
                    HorizontalOptions="End"
                    VerticalOptions="Center"
                    BorderColor="{DynamicResource Primary}"
                    BorderWidth="1"
                    BackgroundColor="Transparent"
                    Clicked="OnSortDirectionClicked"/>
            <Border VerticalOptions="Center"
                    HeightRequest="38"
                    StrokeThickness="1"
                    Stroke="{DynamicResource Primary}"
                    StrokeShape="RoundRectangle 4">
                <Grid VerticalOptions="Center" HorizontalOptions="Fill">
                    <Picker x:Name="SortPicker"
                            x:DataType="services:SettingsService" BindingContext="{x:Static services:SettingsService.Instance}"
                            FontSize="10"
                            VerticalOptions="Center"
                            HorizontalOptions="Fill"
                            ItemsSource="{Binding IconSortCrits}"
                            SelectedItem="{Binding IconSortCrit}"/>
                </Grid>
            </Border>
        </HorizontalStackLayout>

        <Grid x:DataType="views:IconGallery" Grid.Row="1">
            <CollectionView x:Name="IconCollectionView"
                            ItemsSource="{Binding Icons}"
                            ItemTemplate="{StaticResource IconListTemplate}"
                            ItemsUpdatingScrollMode="KeepItemsInView"
                            CanReorderItems="False"
                            ItemSizingStrategy="MeasureFirstItem"
                            SelectionMode="None">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" Span="{Binding DynamicSpan}"/>
                </CollectionView.ItemsLayout>
            </CollectionView>
        </Grid>
        <Label Grid.Row="2"
               Text="{x:Static res:AppResources.gedr체ckt_halten_um_Icon_zu_editieren}"
               FontSize="12"/>
    </Grid>
</ContentPage>
