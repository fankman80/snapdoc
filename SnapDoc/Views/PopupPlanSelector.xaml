<?xml version="1.0" encoding="utf-8" ?>
<toolkit:Popup xmlns="http://schemas.microsoft.com/dotnet/maui/global"
               xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
               xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
               xmlns:uranium="http://schemas.enisn-projects.io/dotnet/maui/uraniumui"
               xmlns:material="http://schemas.enisn-projects.io/dotnet/maui/uraniumui/material"
               xmlns:controls="clr-namespace:SnapDoc.Controls"
               xmlns:views="clr-namespace:SnapDoc.Views"
               xmlns:res="clr-namespace:SnapDoc.Resources.Languages"
               BackgroundColor="{AppThemeBinding Light={DynamicResource PrimaryBackground}, Dark={DynamicResource PrimaryBackgroundDark}}"
               HorizontalOptions="Center"
               xmlns:services="clr-namespace:SnapDoc.Services"
               x:TypeArguments="local:PlanSelectorReturn"
               xmlns:local="clr-namespace:SnapDoc"
               x:Class="SnapDoc.Views.PopupPlanSelector">

    <toolkit:Popup.Resources>
        <ResourceDictionary>
            <toolkit:InvertedBoolConverter x:Key="InvertedBoolConverter" />
            <services:ExportToGlyphConverter x:Key="ExportToGlyphConverter" />
            <services:SelectedToGlyphConverter x:Key="SelectedToGlyphConverter" />
        </ResourceDictionary>
    </toolkit:Popup.Resources>

    <Grid Padding="12"
          WidthRequest="320">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <material:RadioButtonGroupView Grid.Row="0"
                                       x:Name="RadioButtonGroup"
                                       Margin="2,0,0,0"
                                       HorizontalOptions="Start"
                                       Orientation="Vertical"
                                       SelectedItemChanged="OnRadioButtonChanged">
            <material:RadioButton Value="0"
                                  Text="{x:Static res:AppResources.auf_anderen_plan_kopieren}"
                                  CircleColor="{AppThemeBinding Light=LightGray, Dark=Gray}"
                                  Color="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDarkAccent}}"/>
            <material:RadioButton Value="1"
                                  Text="{x:Static res:AppResources.auf_anderen_plan_verschieben}"
                                  CircleColor="{AppThemeBinding Light=LightGray, Dark=Gray}"
                                  Color="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDarkAccent}}"/>
            <material:RadioButton Value="2"
                                  Text="{x:Static res:AppResources.an_ort_duplizieren}"
                                  CircleColor="{AppThemeBinding Light=LightGray, Dark=Gray}"
                                  Color="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDarkAccent}}"/>            
        </material:RadioButtonGroupView>

        <Label Grid.Row="1"
               Margin="0,10,0,0"
               x:DataType="local:Views.PopupPlanSelector"
               IsVisible="{Binding IsNotDuplicateAtLocation}">
            <Label.FormattedText>
                <FormattedString>
                    <Span Text="{x:Static res:AppResources.ziel_auswaehlen}" />
                    <Span Text=":" />
                </FormattedString>
            </Label.FormattedText>
        </Label>

        <ScrollView Grid.Row="2"
                    VerticalOptions="Start"
                    MaximumHeightRequest="800"
                    x:DataType="local:Views.PopupPlanSelector"
                    IsVisible="{Binding IsNotDuplicateAtLocation}">
            <CollectionView x:Name="PlanCollectionView"
                            x:DataType="local:Views.PopupPlanSelector"
                            ItemsSource="{Binding PlanItems}"
                            CanReorderItems="False"
                            SelectionMode="Single"
                            ItemsUpdatingScrollMode="KeepItemsInView"
                            SelectionChanged="OnPlanSelectionChanged">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="local:PlanItem">
                        <Grid ColumnDefinitions="Auto,*,Auto" HeightRequest="44">
                            <Grid.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnPlanTapped" CommandParameter="{Binding PlanRoute}" />
                            </Grid.GestureRecognizers>

                            <Border Grid.Column="0" Grid.ColumnSpan="3"
                                    BackgroundColor="{Binding PlanColor}"
                                    StrokeThickness="0"/>

                            <Label Grid.Column="1"
                                   Text="{Binding Title}"
                                   VerticalOptions="Center"/>

                            <Label Grid.Column="2"
                                   Text="{Binding AllowExport, Converter={StaticResource ExportToGlyphConverter}}"
                                   Padding="0,0,10,0"
                                   FontFamily="MaterialOutlined"
                                   FontSize="18"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"
                                   BackgroundColor="Transparent"/>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </ScrollView>

        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Button Grid.Column="0"
                    Text="{x:Static res:AppResources.abbrechen}"
                    BackgroundColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                    TextColor="{DynamicResource PrimaryDarkText}"
                    Clicked="OnCancelClicked" />
            <Button Grid.Column="1"
                    x:DataType="local:Views.PopupPlanSelector"
                    Text="{x:Static res:AppResources.ok}"
                    IsVisible="{Binding IsPlanSelected}"
                    BackgroundColor="{AppThemeBinding Light={DynamicResource Primary}, Dark={DynamicResource PrimaryDark}}"
                    TextColor="{DynamicResource PrimaryDarkText}"
                    Clicked="OnOkClicked" />
        </Grid>
    </Grid>
</toolkit:Popup>
